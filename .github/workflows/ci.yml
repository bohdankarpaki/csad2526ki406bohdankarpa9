name: CI Build and Test

on:
  push:
    # Запускати для гілок master, develop, а також для всіх feature-гілок
    branches: [ master, develop, feature/develop/5-github-actions ]
  pull_request:
    branches: [ master, develop ]

jobs:
  # Єдина задача, яка виконує збірку та тестування на всіх платформах
  build_and_test:
    name: Build & Test on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      # Матриця для запуску на трьох основних ОС
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Єдиний крок для збірки та тестування, що працює на всіх ОС
      - name: Build and Test with Ninja
        shell: bash
        run: |
          # Створюємо директорію для збірки
          mkdir -p build
          cd build
          
          # Конфігуруємо проєкт, вказуючи Ninja як генератор
          # Це вирішує проблеми зі збіркою на Windows
          cmake .. -G "Ninja"
          
          # Збираємо проєкт
          cmake --build .
          
          # Запускаємо тести з детальним виводом у разі помилки
          ctest --output-on-failure

      # Зберігаємо результати збірки (артефакти)
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-results-${{ matrix.os }}
          path: build/